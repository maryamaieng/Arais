# ----------------------------------------------------
# 1. تعريف الأدوار (لأغراض الأمان)
# ----------------------------------------------------

enum UserRole {
  ADMIN   # المدير (أنت)
  OWNER   # صاحب القاعة
  CLIENT  # العميل / الزبون
}

# ----------------------------------------------------
# 2. نموذج القاعة (Hall)
# ----------------------------------------------------

type Hall @model 
@auth(rules: [
  { allow: owner, operations: [read, update], ownerField: "hallOwnerId" }, # المالك يستطيع التحديث والقراءة
  { allow: public, operations: [read] },                                   # العميل يستطيع القراءة فقط
  { allow: groups, groups: ["Admins"], operations: [create, update, delete] } # الأدمن يستطيع كل شيء
])
{
  id: ID!
  name: String!           # اسم القاعة
  description: String     # وصف مفصل
  capacity: Int!          # السعة القصوى للأشخاص
  size: String            # الحجم بالمتر المربع
  basePrice: Float!       # السعر الأساسي للحجز
  location: String        # موقع القاعة
  isAvailable: Boolean!   # التوفر العام (تحديث فوري من قبل المالك)
  images: [String]        # صور القاعة (روابط S3)
  
  # علاقة المالك
  hallOwnerId: String!    # ID مالك القاعة (مرتبط بـ Cognito)

  # العلاقة مع الحجوزات
  bookings: [Booking] @hasMany(indexName: "byHall", fields: ["id"])
}

# ----------------------------------------------------
# 3. نموذج الحجز (Booking)
# ----------------------------------------------------

type Booking @model 
@auth(rules: [
  { allow: owner, operations: [read, update], ownerField: "clientId" }, # العميل (المستخدم) يستطيع قراءة وتعديل حجزه
  { allow: groups, groups: ["Admins", "Owners"], operations: [read] }   # الأدمن والمالك يستطيعون القراءة
])
{
  id: ID!
  hallId: ID! @index(name: "byHall", queryField: "bookingsByHall") # مفتاح ربط بالقاعة
  clientId: String! # ID العميل الذي قام بالحجز

  # تفاصيل الحجز
  bookingDate: AWSDate!      # تاريخ العرس المحدد
  totalAmount: Float!        # المبلغ الكلي (السعر الأساسي + الإضافات)
  status: String!            # حالة الحجز (Pending, Confirmed, Paid)
  
  # الإضافات التي طلبها العميل
  addons: [Addon]
}

# 4. نموذج الإضافات (Addon) - (الكوشات والطعام والموسيقى)
type Addon {
  name: String!
  price: Float!
  quantity: Int
}
