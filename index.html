<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>زفاف - النظام المتكامل (UI)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
:root{--primary:#8B4513;--primary-light:#A0522D;--secondary:#D4AF37;--secondary-light:#E5C158;--accent:#8B0000;--light:#F9F3E9;--dark:#2C1810;--gray:#7A6A5C;--success:#2E8B57;--warning:#FFA500;--danger:#DC143C;--shadow:0 4px 12px rgba(0,0,0,0.12);--radius:12px;}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Arial;}
body{background:#f5f5f5;color:var(--dark);line-height:1.6}
/* Login */
.login-container{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,var(--primary),var(--dark));padding:20px}
.login-box{background:white;padding:32px;border-radius:var(--radius);box-shadow:var(--shadow);width:100%;max-width:420px;text-align:center}
.login-title{color:var(--primary);font-size:1.8rem;margin-bottom:6px}
.login-subtitle{color:var(--gray);margin-bottom:18px}
.user-type-selector{display:flex;margin-bottom:16px;border-radius:10px;overflow:hidden;border:2px solid var(--primary)}
.user-type{flex:1;padding:10px;background:white;border:none;cursor:pointer;font-weight:600;transition:all .2s}
.user-type.active{background:var(--primary);color:#fff}
.form-group{text-align:right;margin-bottom:12px}
label{display:block;margin-bottom:6px;font-weight:600;color:var(--dark)}
.form-control{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #ddd}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 18px;background:var(--primary);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700;width:100%}
.btn-secondary{background:var(--secondary);color:#111}
.btn:hover{transform:translateY(-2px)}
.dashboard{display:none;min-height:100vh}
</style>
</head>
<body>

<!-- شاشة تسجيل الدخول -->
<div class="login-container" id="loginScreen">
  <div class="login-box">
    <h1 class="login-title">زفاف</h1>
    <p class="login-subtitle">النظام المتكامل لإدارة القاعات</p>
    <div class="user-type-selector">
      <button class="user-type active" data-type="admin">مدير</button>
      <button class="user-type" data-type="owner">صاحب القاعة</button>
      <button class="user-type" data-type="customer">عميل</button>
    </div>
    <div class="form-group">
      <label for="username">اسم المستخدم</label>
      <input type="text" id="username" class="form-control" placeholder="أدخل اسم المستخدم">
    </div>
    <div class="form-group">
      <label for="password">كلمة المرور</label>
      <input type="password" id="password" class="form-control" placeholder="أدخل كلمة المرور">
    </div>
    <button class="btn" id="loginBtn">تسجيل الدخول</button>
  </div>
</div>

<!-- واجهات المدير - صاحب القاعة - العميل -->
<div class="dashboard" id="adminDashboard"></div>
<div class="dashboard" id="ownerDashboard"></div>
<div class="dashboard" id="customerDashboard"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const API_URL = "https://jbph80gaih.execute-api.us-east-1.amazonaws.com/dev"; // Invoke URL

  const loginScreen = document.getElementById('loginScreen');
  const adminDashboard = document.getElementById('adminDashboard');
  const ownerDashboard = document.getElementById('ownerDashboard');
  const customerDashboard = document.getElementById('customerDashboard');
  const userTypes = document.querySelectorAll('.user-type');
  const loginBtn = document.getElementById('loginBtn');

  let selectedType = 'admin';
  userTypes.forEach(t => {
    t.addEventListener('click', function () {
      userTypes.forEach(x => x.classList.remove('active'));
      this.classList.add('active');
      selectedType = this.dataset.type;
    });
  });

  loginBtn.addEventListener('click', async function () {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    try {
      const res = await fetch(${API_URL}/login, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({username,password,userType:selectedType})
      });
      const data = await res.json();
      if(data.success){
        loginScreen.style.display='none';
        adminDashboard.style.display=selectedType==='admin'?'flex':'none';
        ownerDashboard.style.display=selectedType==='owner'?'flex':'none';
        customerDashboard.style.display=selectedType==='customer'?'block':'none';
        // تحميل بيانات القاعات والحجوزات من Lambda
        if(selectedType==='customer') loadHalls();
      } else {
        alert(data.message||"خطأ في تسجيل الدخول");
      }
    } catch(err){
      console.error(err);
      alert("خطأ في الاتصال بالخادم");
    }
  });

  async function loadHalls(){
    try{
      const res = await fetch(${API_URL}/halls);
      const halls = await res.json();
      customerDashboard.innerHTML = <h2>القاعات المتاحة</h2> +
        halls.map(h=>`<div style="margin-bottom:16px; border:1px solid #ddd;padding:10px;border-radius:8px">
        <h3>${h.name}</h3>
        <p>${h.desc}</p>
        <strong>${h.price} د.ع</strong>
        <button class="btn" onclick="bookHall('${h.id}')">احجز الآن</button>
        </div>`).join('');
    } catch(err){ console.error(err); }
  }

  window.bookHall = async function(hallId){
    const name = prompt("اسم الزبون:");
    const date = prompt("تاريخ المناسبة YYYY-MM-DD:");
    const guests = prompt("عدد المدعوين:");
    if(!name || !date || !guests) return alert("مطلوب جميع البيانات");
    try{
      const res = await fetch(${API_URL}/book, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({hallId,name,date,guests})
      });
      const data = await res.json();
      if(data.success) alert("تم الحجز بنجاح!");
      else alert(data.message||"فشل الحجز");
    } catch(err){console.error(err);}
  };

});
</script>
</body>
</html>
